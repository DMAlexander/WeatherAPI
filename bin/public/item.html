<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Weather App</title>
    </head>
    <body>
        <h1>Item Information</h1>
        <div><a href="index.html">Search Weather Page</a></div>
        <div><a href="all.html">All Saved Entries</a></div>
        <p>-------------------------------</p>

        <h3>Item Data</h3>

    <script src="item.js"></script>

    </body>
    <script>
        getItemData();
 
            async function getItemData() {
                
                //Getting id parameter...
                const params = new 
                URLSearchParams(window.location.search)
                var id = params.get('id');
                var initialComment = params.get('comment');


                const response = await fetch('/weather/' + id);
                const data = await response.json();

                    
                const temp = document.getElementById('div');
                const tempLow = document.getElementById('div');
                const tempHigh = document.getElementById('div');
                    const windSpeed = document.getElementById('div');
                    const root = document.createElement('div');

                    const date = document.createElement('div');
                    const commentsend = document.createElement('div');
                    const tempSend = document.createElement('div');
                    const tempLowSend = document.createElement('div');
                    const tempHighSend = document.createElement('div');
                    const windSpeedSend = document.createElement('div');
                    const idSend = document.createElement('div');

                    var newdiv = document.createElement('div');
                    newdiv.setAttribute('style', 'page-break-after:always');

                    tempSend.textContent = 'Current Temperature: ' + data.temp;

                    tempLowSend.textContent = 'Todays Low: ' + data.templow;
                    tempHighSend.textContent = 'Todays High: ' + data.temphigh;
                    windSpeedSend.textContent = 'Wind Speed: ' + data.windspeed;
                    idSend.textContent = 'Row id: ' + data.id;
                    const dateString = new Date(data.timestamp).toLocaleString();
                    date.textContent = 'Record Created On: ' + dateString;

                    idSend.setAttribute("hidden", true);

                    var input = document.createElement('input');
                    var commentText = document.createTextNode(data.comment);
                    input.appendChild(commentText);
                    input.id = 'comment';
                    input.value = data.comment;

                    var updateButton = document.createElement('button');
                    var updateButtonText = document.createTextNode("Update Comment");
                    updateButton.appendChild(updateButtonText);
                    updateButton.id = 'updateComment';
                    updateButton.value = 'update';

                    var deleteButton = document.createElement('button');
                    var deleteButtonText = document.createTextNode("Delete row");
                    deleteButton.appendChild(deleteButtonText);
                    deleteButton.id = 'deleteRow';
                    deleteButton.value = 'delete';
 
                    root.append(tempSend, tempLowSend, tempHighSend, windSpeedSend, date, idSend, newdiv, input, updateButton, deleteButton);
                    root.append(' ');
                    document.body.append(root);
                    
          }

            document.addEventListener('click', async function(e) {
                if(e.target && e.target.id == 'updateComment'){
                    console.log("Hello world!");
                    
                    const params = new 
                    URLSearchParams(window.location.search)
                    var id = params.get('id');
                    var initialComment = params.get('comment');
                    var comment = document.getElementById('comment').value

                    const data = { id, initialComment, comment }
                    const options = {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    }
                    const response = await fetch('/weather/' + id + '/' + comment, options);
                    const json = await response.json();
                    console.log(json);
                    
                    }
                });

            document.addEventListener('click', async function(e) {
                if(e.target && e.target.id == 'deleteRow'){

                //Getting id parameter...
                const params = new
                URLSearchParams(window.location.search)
                var id = params.get('id');

                const data = { id }
                const options = {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                }

                const response = await fetch('weather/' + id, options);
                const json = await response.json();
                console.log(json);
            }
        });
    </script>
</html>
</html>